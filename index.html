<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="subject" content="Simple blog">
    <meta name="description" content="Simple blog">
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="google" content="nositelinkssearchbox">
    <meta name="google" content="notranslate">
    <link rel="me" href="https://www.facebook.com/gennadii.genin" type="text/html">
    <link rel="me" href="mailto:genin.gennadiigendos2010@yandex.ru">
    <link rel="me" href="sms:+48792371282">
    <title>Blog</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="./dist/styles.css">
    <!--page icon-->
    <!--<link rel="icon" type="image/png" href=""/>-->
    <!--<meta http-equiv="refresh" content="1">-->
</head>
<body>
<div id="app">
    <div id="sorting-tags"></div>
    <div id="cards"></div>
</div>
<!--<script src="src/index.js"></script>-->
<script src="./dist/bundle.js"></script>
<script>
    window.onload = () => {
        fetch('https://api.myjson.com/bins/152f9j')
            .then(response => {
                response.json().then(json_data => {
                    createApp(json_data.data);
                    return window.parent.json_data = json_data;
                })
            })
            .catch(err => {
                console.log('Woooops, shit happens');
                console.log(err);
            })
    };

    // json structure
    /*{
        "title":"Quo repudiandae qui sit.",
        "description":"Some text",
        "image":"http://via.placeholder.com/150x150",
        "createdAt":"0290-01-20T18:19:35.727Z",
        "tags":[
        "Business",
        "Politics",
        "Sport"]
    }*/

    let app = document.getElementById('app');
    let cards = document.getElementById('cards');
    cards.addEventListener('click',()=>{
        console.log('click cards');
    });
    let tags = document.getElementById('sorting-tags');


    function createApp(j_data) {
        let tags_arr = getUniqueTags(j_data);
        createTags(tags_arr);
        for (let i = 0; i < j_data.length; i++) {
            createCard(j_data[i]);
        }
        app.appendChild(tags);
        app.appendChild(cards);
        sortElements();
    }

    //get unique elements from arr
    function onlyUnique(value, index, self) {
        return self.indexOf(value) === index;
    }

    function getUniqueTags(j_data) {
        let allTags = [];
        for (let i = 0; i < j_data.length; i++) {
            for (let c = 0; c < j_data[i].tags.length; c++) {
                allTags.push(j_data[i].tags[c]);
            }
        }
        return allTags.filter(onlyUnique);
    }

    function createTags(tags_arr) {
        for (let i = 0; i < tags_arr.length; i++) {
            let tag = document.createElement('span');
            tag.setAttribute('class', 'tag');
            tag.setAttribute('onclick', 'toggleTag(event)');
            let tagText = document.createTextNode(tags_arr[i]);
            tag.appendChild(tagText);
            tags.appendChild(tag);
        }
    }

    function createCard(j_data) {

        let card = document.createElement('div');
        card.setAttribute('class', 'card-box');

        let deleteButton = document.createElement('button');
        deleteButton.setAttribute('onclick', 'deleteElement(event)');
        let deleteButtonText = document.createTextNode('delete');
        deleteButton.appendChild(deleteButtonText);

        let title = document.createElement('h3');
        let titleText = document.createTextNode(j_data.title);
        title.appendChild(titleText);

        let description = document.createElement('span');
        description.setAttribute('class', 'description');
        let descriptionText = document.createTextNode(j_data.description);
        description.appendChild(descriptionText);

        let photo = document.createElement('img');
        photo.setAttribute('src', j_data.image);

        let date = document.createElement('span');
        date.setAttribute('class', 'date');
        let dateText = document.createTextNode(j_data.createdAt);
        date.appendChild(dateText);

        let tags = document.createElement('ul');
        for (let i = 0; i < j_data.tags.length; i++) {
            let tag = document.createElement('li');
            let tagText = document.createTextNode(j_data.tags[i]);
            tag.appendChild(tagText);
            tags.appendChild(tag);
        }

        card.appendChild(deleteButton);
        card.appendChild(title);
        card.appendChild(description);
        card.appendChild(photo);
        card.appendChild(date);
        card.appendChild(tags);
        cards.appendChild(card);

    }

    function deleteElement(e){
        console.log(e);
        e.stopPropagation();
        cards.removeChild(e.path[1]);
    }

    let selected_tags_arr = [];

    function toggleTag(e) {
        let tag = e.target;
        tag.classList.toggle('selected-tag');
        if (tag.classList.contains('selected-tag')) {
            selected_tags_arr.push(tag.innerHTML);
        } else {
            for (let i = 0; i < selected_tags_arr.length; i++) {
                if(tag.innerHTML === selected_tags_arr[i]){
                    selected_tags_arr.splice(i,1);
                }
            }
        }
        sortElements(selected_tags_arr);
    }
    // sorting functions

    function sortElements(selected) {
        console.log(selected);
        let order = [];
        let el_to_sort = document.getElementsByClassName('card-box');
        console.log(el_to_sort[0].childNodes[5].childNodes[0].innerText);
        for(let i = 0;i<el_to_sort.length;i++){
            let obj_arr = [];
            for(let c = 0;c<el_to_sort[i].childNodes[5].childNodes.length;c++){
                obj_arr.push(el_to_sort[i].childNodes[5].childNodes[c].innerText);
            }
            order.push(obj_arr);
        }
        console.log(order);
        // let element_to_sort = document.getElementsByClassName('card-box');
        // console.log(element_to_sort);
        // let tags = element_to_sort[0].childNodes[4];
        // console.log(tags);

        function swapNodes(node1, node2) {
            node2_copy = node2.cloneNode(true);
            node1.parentNode.insertBefore(node2_copy, node1);
            node2.parentNode.insertBefore(node1, node2);
            node2.parentNode.replaceChild(node2, node2_copy);
        }
    }
</script>
</body>
</html>